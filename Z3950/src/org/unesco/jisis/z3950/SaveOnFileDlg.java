/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * SaveOnFileDlg.java
 *
 * Created on 25 nov. 2010, 16:55:00
 */

package org.unesco.jisis.z3950;

import java.io.File;
import org.unesco.jisis.corelib.common.Global;
import org.unesco.jisis.gui.DirectoryChooser;

/**
 *
 * @author jcd
 */
public class SaveOnFileDlg extends javax.swing.JDialog {
    /** A return status code - returned if Cancel button has been pressed */
    public static final int RET_CANCEL = 0;
    /** A return status code - returned if OK button has been pressed */
    public static final int RET_OK = 1;

    /** Creates new form SaveOnFileDlg */
    public SaveOnFileDlg(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        txtExpDirectory.setText(Global.prefs_.get("Z3950_EXPORT_DIR", ""));
    }

    /** @return the return status of this dialog - one of RET_OK or RET_CANCEL */
    public int getReturnStatus() {
        return returnStatus;
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
   // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
   private void initComponents() {

      okButton = new javax.swing.JButton();
      cancelButton = new javax.swing.JButton();
      jLabel2 = new javax.swing.JLabel();
      expFileName = new javax.swing.JTextField();
      lblOutputDirectory = new javax.swing.JLabel();
      txtExpDirectory = new javax.swing.JTextField();
      btnSelectDir = new javax.swing.JButton();

      addWindowListener(new java.awt.event.WindowAdapter() {
         public void windowClosing(java.awt.event.WindowEvent evt) {
            closeDialog(evt);
         }
      });

      okButton.setText(org.openide.util.NbBundle.getMessage(SaveOnFileDlg.class, "SaveOnFileDlg.okButton.text")); // NOI18N
      okButton.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            okButtonActionPerformed(evt);
         }
      });

      cancelButton.setText(org.openide.util.NbBundle.getMessage(SaveOnFileDlg.class, "SaveOnFileDlg.cancelButton.text")); // NOI18N
      cancelButton.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            cancelButtonActionPerformed(evt);
         }
      });

      jLabel2.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
      jLabel2.setText(org.openide.util.NbBundle.getMessage(SaveOnFileDlg.class, "SaveOnFileDlg.jLabel2.text")); // NOI18N

      lblOutputDirectory.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
      lblOutputDirectory.setText(org.openide.util.NbBundle.getMessage(SaveOnFileDlg.class, "SaveOnFileDlg.lblOutputDirectory.text")); // NOI18N

      txtExpDirectory.setEditable(false);

      btnSelectDir.setText(org.openide.util.NbBundle.getMessage(SaveOnFileDlg.class, "SaveOnFileDlg.btnSelectDir.text")); // NOI18N
      btnSelectDir.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            btnSelectDirActionPerformed(evt);
         }
      });

      javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
      getContentPane().setLayout(layout);
      layout.setHorizontalGroup(
         layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(layout.createSequentialGroup()
            .addContainerGap()
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
               .addComponent(lblOutputDirectory)
               .addComponent(jLabel2))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
               .addGroup(layout.createSequentialGroup()
                  .addComponent(txtExpDirectory, javax.swing.GroupLayout.PREFERRED_SIZE, 430, javax.swing.GroupLayout.PREFERRED_SIZE)
                  .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                  .addComponent(btnSelectDir))
               .addComponent(expFileName, javax.swing.GroupLayout.PREFERRED_SIZE, 256, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addContainerGap())
         .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
            .addContainerGap(264, Short.MAX_VALUE)
            .addComponent(okButton, javax.swing.GroupLayout.PREFERRED_SIZE, 67, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(cancelButton)
            .addGap(265, 265, 265))
      );

      layout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {cancelButton, okButton});

      layout.setVerticalGroup(
         layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
         .addGroup(layout.createSequentialGroup()
            .addGap(79, 79, 79)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(jLabel2)
               .addComponent(expFileName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(txtExpDirectory, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
               .addComponent(lblOutputDirectory)
               .addComponent(btnSelectDir))
            .addGap(150, 150, 150)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
               .addComponent(cancelButton)
               .addComponent(okButton))
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
      );

      pack();
   }// </editor-fold>//GEN-END:initComponents

    private void okButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_okButtonActionPerformed
        doClose(RET_OK);
    }//GEN-LAST:event_okButtonActionPerformed

    private void cancelButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelButtonActionPerformed
        doClose(RET_CANCEL);
    }//GEN-LAST:event_cancelButtonActionPerformed

    /** Closes the dialog */
    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog
        doClose(RET_CANCEL);
    }//GEN-LAST:event_closeDialog

    private void btnSelectDirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSelectDirActionPerformed
       selectDirectory();
    }//GEN-LAST:event_btnSelectDirActionPerformed
   public String getSelectedFile(int export) {
      String ext[] = new String[]{ ".iso",".xml", ".mrcxml", ".txt"};
      String fileName = expFileName.getText();
      if (export >=ext.length) export=0;
      String extension = ext[export];
      if (!fileName.toLowerCase().endsWith(extension)) {
         fileName += extension;
      }
      String fullFileName = Global.prefs_.get("Z3950_EXPORT_DIR", "") + "\\"
              + fileName;

      return fullFileName;
   }

   private String selectDirectory() {

      //prefs = Preferences.userNodeForPackage(this.getClass());
      String lastDir = Global.getClientWorkPath();
      DirectoryChooser dc = new DirectoryChooser(new File(lastDir));
      dc.showOpenDialog(this);
      File file;
      if ((file = dc.getSelectedFile()) != null) {
         Global.prefs_.put("Z3950_EXPORT_DIR", file.getAbsolutePath());
         txtExpDirectory.setText(file.getAbsolutePath());
         return file.getAbsolutePath();
      }
      return "";

   }
    private void doClose(int retStatus) {
        returnStatus = retStatus;
        setVisible(false);
        dispose();
    }

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
         @Override
            public void run() {
                SaveOnFileDlg dialog = new SaveOnFileDlg(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
               @Override
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

   // Variables declaration - do not modify//GEN-BEGIN:variables
   private javax.swing.JButton btnSelectDir;
   private javax.swing.JButton cancelButton;
   private javax.swing.JTextField expFileName;
   private javax.swing.JLabel jLabel2;
   private javax.swing.JLabel lblOutputDirectory;
   private javax.swing.JButton okButton;
   private javax.swing.JTextField txtExpDirectory;
   // End of variables declaration//GEN-END:variables

    private int returnStatus = RET_CANCEL;
}
